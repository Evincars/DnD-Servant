<div class="m-card">
  <button class="m-close" (click)="close.emit()" title="Zavřít">✕</button>

  @if (loading()) {
    <div class="m-loading">
      <mat-icon class="m-loading__icon">hourglass_empty</mat-icon>
      <span>Načítám příšeru…</span>
    </div>
  }

  @if (error()) {
    <div class="m-error">⚠ {{ error() }}</div>
  }

  @if (monster(); as m) {
    <div class="m-name">{{ m.name }}</div>
    <div class="m-meta">
      {{ m.size }} {{ m.type }}
      @if (m.subtype) { ({{ m.subtype }}) }
      @if (m.alignment) { · {{ m.alignment }} }
    </div>

    <div class="m-rule"></div>

    <!-- Core stat pills -->
    <div class="m-stat-row">
      @if (m.armor_class?.length) {
        <div class="m-stat-pill">
          <span class="m-stat-pill__label">OČ</span>
          <span class="m-stat-pill__val">
            {{ m.armor_class[0].value }}
            @if (m.armor_class[0].type) { <small>({{ m.armor_class[0].type }})</small> }
          </span>
        </div>
      }
      @if (m.hit_points) {
        <div class="m-stat-pill">
          <span class="m-stat-pill__label">ŽB</span>
          <span class="m-stat-pill__val">
            {{ m.hit_points }}
            @if (m.hit_dice) { <small>({{ m.hit_dice }})</small> }
          </span>
        </div>
      }
      @if (m.challenge_rating != null) {
        <div class="m-stat-pill">
          <span class="m-stat-pill__label">CR</span>
          <span class="m-stat-pill__val">{{ m.challenge_rating }}</span>
        </div>
      }
      @if (m.xp) {
        <div class="m-stat-pill">
          <span class="m-stat-pill__label">XP</span>
          <span class="m-stat-pill__val">{{ m.xp }}</span>
        </div>
      }
      @if (m.proficiency_bonus) {
        <div class="m-stat-pill">
          <span class="m-stat-pill__label">Zdatnost</span>
          <span class="m-stat-pill__val">+{{ m.proficiency_bonus }}</span>
        </div>
      }
    </div>

    <!-- Speed -->
    @if (m.speed && hasSpeed(m)) {
      <div class="m-line">
        <b>Pohyb:</b>
        @if (m.speed.walk)   { <span>chůze {{ m.speed.walk }}</span> }
        @if (m.speed.swim)   { <span>plavání {{ m.speed.swim }}</span> }
        @if (m.speed.fly)    { <span>let {{ m.speed.fly }}</span> }
        @if (m.speed.burrow) { <span>hrabání {{ m.speed.burrow }}</span> }
        @if (m.speed.climb)  { <span>šplhání {{ m.speed.climb }}</span> }
      </div>
    }

    <div class="m-rule"></div>

    <!-- Ability scores -->
    <div class="m-abilities">
      <div class="m-ab"><div class="m-ab__lbl">SIL</div><div class="m-ab__val">{{ m.strength }}</div><div class="m-ab__mod">{{ mod(m.strength) }}</div></div>
      <div class="m-ab"><div class="m-ab__lbl">OBR</div><div class="m-ab__val">{{ m.dexterity }}</div><div class="m-ab__mod">{{ mod(m.dexterity) }}</div></div>
      <div class="m-ab"><div class="m-ab__lbl">ODL</div><div class="m-ab__val">{{ m.constitution }}</div><div class="m-ab__mod">{{ mod(m.constitution) }}</div></div>
      <div class="m-ab"><div class="m-ab__lbl">INT</div><div class="m-ab__val">{{ m.intelligence }}</div><div class="m-ab__mod">{{ mod(m.intelligence) }}</div></div>
      <div class="m-ab"><div class="m-ab__lbl">MDR</div><div class="m-ab__val">{{ m.wisdom }}</div><div class="m-ab__mod">{{ mod(m.wisdom) }}</div></div>
      <div class="m-ab"><div class="m-ab__lbl">CHA</div><div class="m-ab__val">{{ m.charisma }}</div><div class="m-ab__mod">{{ mod(m.charisma) }}</div></div>
    </div>

    <div class="m-rule"></div>

    <!-- Properties -->
    @if (m.proficiencies?.length)          { <div class="m-prop"><b>Zdatnosti:</b> {{ profList(m) }}</div> }
    @if (m.damage_vulnerabilities?.length) { <div class="m-prop"><b>Zranitelnosti:</b> {{ m.damage_vulnerabilities.join(', ') }}</div> }
    @if (m.damage_resistances?.length)     { <div class="m-prop"><b>Odolnosti:</b> {{ m.damage_resistances.join(', ') }}</div> }
    @if (m.damage_immunities?.length)      { <div class="m-prop"><b>Imunity (poškození):</b> {{ m.damage_immunities.join(', ') }}</div> }
    @if (m.condition_immunities?.length)   { <div class="m-prop"><b>Imunity (stavy):</b> {{ conditionNames(m) }}</div> }
    @if (m.senses)                         { <div class="m-prop"><b>Smysly:</b> {{ sensesText(m) }}</div> }
    @if (m.languages)                      { <div class="m-prop"><b>Jazyky:</b> {{ m.languages }}</div> }

    <!-- Special abilities -->
    @if (m.special_abilities?.length) {
      <div class="m-rule"></div>
      <div class="m-section">Speciální schopnosti</div>
      @for (a of m.special_abilities; track a.name) {
        <p class="m-ability"><b class="m-ability__name">{{ a.name }}.</b> {{ a.desc }}</p>
      }
    }

    <!-- Actions -->
    @if (m.actions?.length) {
      <div class="m-rule"></div>
      <div class="m-section">Akce</div>
      @for (a of m.actions; track a.name) {
        <p class="m-ability">
          <b class="m-ability__name">{{ a.name }}.</b> {{ a.desc }}
          @if (a.attack_bonus != null) { <span class="m-tag">+{{ a.attack_bonus }} k zásahu</span> }
          @if (a.dc) { <span class="m-tag">SO {{ a.dc.dc_value }} {{ a.dc.dc_type.name }}</span> }
        </p>
      }
    }

    <!-- Legendary actions -->
    @if (m.legendary_actions?.length) {
      <div class="m-rule"></div>
      <div class="m-section">Legendární akce</div>
      @for (a of m.legendary_actions; track a.name) {
        <p class="m-ability"><b class="m-ability__name">{{ a.name }}.</b> {{ a.desc }}</p>
      }
    }

    <!-- Reactions -->
    @if (m.reactions?.length) {
      <div class="m-rule"></div>
      <div class="m-section">Reakce</div>
      @for (a of m.reactions; track a.name) {
        <p class="m-ability"><b class="m-ability__name">{{ a.name }}.</b> {{ a.desc }}</p>
      }
    }

    @if (m.image) {
      <div class="m-rule"></div>
      <img class="m-image" [src]="'https://www.dnd5eapi.co' + m.image" [alt]="m.name" />
    }
  }
</div>

