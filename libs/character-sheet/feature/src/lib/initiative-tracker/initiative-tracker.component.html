<div class="it-wrapper">
  <div class="it-layout">

    <!-- ‚îÄ‚îÄ Initiative table card ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="it-card">
      <div class="it-header">
        <mat-icon class="it-header__icon">shield</mat-icon>
        <h2 class="it-header__title">Sledov√°n√≠ iniciativy</h2>
      </div>
      <p class="it-notice">Data se ukl√°daj√≠ pouze v tomto prohl√≠≈æeƒçi ‚Äî na jin√©m za≈ô√≠zen√≠ budou ≈ô√°dky pr√°zdn√©.</p>

      <div class="it-col-headers">
        <span class="it-col-header it-col-header--indicator"></span>
        <span class="it-col-header it-col-header--sm">‚öî Init.</span>
        <span class="it-col-header it-col-header--name">üë§ Jm√©no</span>
        <span class="it-col-header it-col-header--sm">üõ° Oƒå</span>
        <span class="it-col-header it-col-header--sm">‚ù§ HP</span>
        <span class="it-col-header it-col-header--icon"></span>
        <span class="it-col-header it-col-header--icon"></span>
      </div>

      <div class="it-rows">
        @for (row of rows(); track $index) {
          <div
            class="it-row"
            [class.it-row--odd]="$index % 2 === 1"
            [class.it-row--active]="$index === activeIndex()"
            [class.it-row--selected]="selectedRowIndex() === $index"
          >
            <span class="it-turn-indicator">{{ $index === activeIndex() ? '‚ñ∂' : '' }}</span>
            <input [(ngModel)]="row.initiative" type="number" class="it-input it-input--sm" placeholder="‚Äî" />
            <input [(ngModel)]="row.name" type="text" class="it-input it-input--name" placeholder="N√°zev / jm√©no" />
            <input [(ngModel)]="row.ac" type="number" class="it-input it-input--sm" placeholder="‚Äî" />
            <input [(ngModel)]="row.hp" type="number" class="it-input it-input--sm" placeholder="‚Äî" />
            <button
              mat-icon-button
              type="button"
              class="it-lookup-btn"
              [class.it-lookup-btn--active]="selectedRowIndex() === $index"
              [class.it-lookup-btn--loading]="loadingIndex() === $index"
              title="Vyhledat p≈ô√≠≈°eru"
              (click)="lookupMonster(row.name, $index)"
            >
              <mat-icon>{{ loadingIndex() === $index ? 'hourglass_empty' : 'search' }}</mat-icon>
            </button>
            <button mat-icon-button type="button" class="it-remove-btn" title="Odstranit ≈ô√°dek" (click)="removeRow($index)">
              <mat-icon>close</mat-icon>
            </button>
          </div>
        }
      </div>

      <div class="it-actions">
        <button type="button" class="it-btn it-btn--add" (click)="addRow()">
          <mat-icon>add</mat-icon> P≈ôidat
        </button>
        <button type="button" class="it-btn it-btn--next" (click)="nextRow()">
          <mat-icon>arrow_downward</mat-icon> Dal≈°√≠ tah
        </button>
        <button type="button" class="it-btn it-btn--sort" (click)="sortRows()">
          <mat-icon>sort</mat-icon> Se≈ôadit
        </button>
        <button type="button" class="it-btn it-btn--save" (click)="save()">
          <mat-icon>save</mat-icon> Ulo≈æit
        </button>
      </div>

      @if (savedMessage()) {
        <p class="it-saved-msg">‚úì Ulo≈æeno do prohl√≠≈æeƒçe</p>
      }
    </div>

    <!-- ‚îÄ‚îÄ Monster detail card ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    @if (monsterData() || monsterError() || loadingIndex() !== null) {
      <monster-card
        [monster]="monsterData()"
        [loading]="loadingIndex() !== null && !monsterData() && !monsterError()"
        [error]="monsterError()"
        (close)="closeMonster()"
      />
    }

  </div>
</div>

